<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura Espacial - Puzles para Ni√±os</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #0a043c;
            color: white;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
        }

        h1 {
            color: #f7d039;
            text-shadow: 2px 2px 4px #000;
            font-size: 2.5em;
        }

        .contenedor-juego {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(10, 4, 60, 0.8);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px #6e3fbc;
        }

        .contenedor-puzle {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .piezas-puzle {
            width: 200px;
            min-height: 300px;
            border: 3px dashed #6e3fbc;
            border-radius: 10px;
            padding: 10px;
            background-color: rgba(110, 63, 188, 0.2);
        }

        .tablero-puzle {
            width: 300px;
            min-height: 300px;
            border: 3px solid #f7d039;
            border-radius: 10px;
            padding: 10px;
            background-color: rgba(247, 208, 57, 0.1);
            position: relative;
        }

        .pieza {
            width: 80px;
            height: 80px;
            margin: 5px;
            cursor: move;
            transition: transform 0.2s;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .pieza:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px #f7d039;
        }

        .espacio {
            width: 80px;
            height: 80px;
            margin: 5px;
            display: inline-block;
            background-color: rgba(247, 208, 57, 0.3);
            border-radius: 8px;
            border: 2px dashed #f7d039;
        }

        .espacio.resaltado {
            background-color: rgba(110, 63, 188, 0.5);
            border: 2px solid #6e3fbc;
        }

        .espacio.lleno {
            border: none;
            background-color: transparent;
        }

        .controles {
            margin: 20px 0;
        }

        .boton {
            background-color: #6e3fbc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .boton:hover {
            background-color: #f7d039;
            color: #0a043c;
            transform: scale(1.05);
        }

        .puntuacion {
            font-size: 1.2em;
            margin: 20px 0;
            color: #f7d039;
        }

        .nivel-actual {
            font-size: 1.5em;
            margin: 10px 0;
            color: #6e3fbc;
            text-shadow: 1px 1px 2px #000;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .contenido-modal {
            background-color: #0a043c;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            border: 3px solid #f7d039;
            box-shadow: 0 0 30px #6e3fbc;
            text-align: center;
            position: relative;
            animation: aparecerModal 0.5s;
        }

        @keyframes aparecerModal {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            color: #f7d039;
            font-size: 2em;
            margin-top: 0;
        }

        .modal p {
            font-size: 1.2em;
            margin: 20px 0;
        }

        .estrellas-modal {
            font-size: 2.5em;
            color: #f7d039;
            margin: 20px 0;
        }

        .imagen-modal {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .cerrar-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        /* Nave espacial decorativa */
        .nave-espacial {
            position: absolute;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="%23f7d039" d="M256 0c-16 0-32 16-32 32v32h64V32c0-16-16-32-32-32zM64 64c-35 0-64 29-64 64v64c0 23 12 43 32 55v234c0 8 8 16 16 16h96c8 0 16-8 16-16V320h192v181c0 8 8 16 16 16h96c8 0 16-8 16-16V247c20-12 32-32 32-55v-64c0-35-29-64-64-64H64zm304 96c0-8-8-16-16-16H160c-8 0-16 8-16 16v64c0 8 8 16 16 16h192c8 0 16-8 16-16v-64z"/></svg>');
            background-size: contain;
            animation: flotar 5s infinite ease-in-out;
            opacity: 0.7;
        }

        @keyframes flotar {
            0%, 100% { transform: translateY(0) rotate(5deg); }
            50% { transform: translateY(-20px) rotate(-5deg); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .contenedor-puzle {
                flex-direction: column;
                align-items: center;
            }
            
            .piezas-puzle, .tablero-puzle {
                width: 90%;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="contenedor-juego">
        <h1>üß© Aventura Espacial üöÄ</h1>
        <div class="nivel-actual">Nivel: <span id="nivel-actual">1</span></div>
        <div class="puntuacion">Puntos: <span id="puntos">0</span> ‚ú®</div>
        
        <div class="contenedor-puzle">
            <div class="piezas-puzle" id="contenedor-piezas">
                <!-- Las piezas del puzle se generar√°n aqu√≠ -->
            </div>
            <div class="tablero-puzle" id="contenedor-tablero">
                <!-- Los espacios del puzle se generar√°n aqu√≠ -->
            </div>
        </div>
        
        <div class="controles">
            <button class="boton" id="boton-reiniciar">Reiniciar Nivel</button>
            <button class="boton" id="boton-siguiente" disabled>Siguiente Nivel</button>
        </div>
    </div>
    
    <!-- Modal de nivel completado -->
    <div class="modal" id="modal-completado">
        <div class="contenido-modal">
            <button class="cerrar-modal" id="cerrar-modal">&times;</button>
            <div class="imagen-modal" id="imagen-modal"></div>
            <h2>¬°Nivel Completado!</h2>
            <p>¬°Gran trabajo, astronauta!</p>
            <div class="estrellas-modal" id="estrellas-modal">‚≠ê‚≠ê‚≠ê</div>
            <p>Has ganado <span id="puntos-ganados">0</span> puntos ‚ú®</p>
            <button class="boton" id="boton-continuar">Continuar</button>
        </div>
    </div>
    
    <script>
        // Datos del juego
        const datosJuego = {
            niveles: [
                {
                    imagen: 'https://cdn.pixabay.com/photo/2016/07/30/19/52/rocket-1557619_960_720.png',
                    piezas: 4,
                    filas: 2,
                    columnas: 2,
                    puntos: 10
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2017/02/12/21/29/moon-2060347_960_720.png',
                    piezas: 6,
                    filas: 2,
                    columnas: 3,
                    puntos: 15
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2016/11/22/15/44/astronaut-1850121_960_720.png',
                    piezas: 9,
                    filas: 3,
                    columnas: 3,
                    puntos: 20
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2011/12/13/17/00/earth-11047_960_720.png',
                    piezas: 12,
                    filas: 3,
                    columnas: 4,
                    puntos: 25
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2016/01/19/16/49/ufo-1149817_960_720.png',
                    piezas: 16,
                    filas: 4,
                    columnas: 4,
                    puntos: 30
                }
            ],
            nivelActual: 0,
            puntuacion: 0,
            piezasCompletadas: 0
        };

        // Elementos del DOM
        const contenedorPiezas = document.getElementById('contenedor-piezas');
        const contenedorTablero = document.getElementById('contenedor-tablero');
        const elementoNivelActual = document.getElementById('nivel-actual');
        const elementoPuntuacion = document.getElementById('puntos');
        const botonReiniciar = document.getElementById('boton-reiniciar');
        const botonSiguiente = document.getElementById('boton-siguiente');
        const modalCompletado = document.getElementById('modal-completado');
        const botonCerrarModal = document.getElementById('cerrar-modal');
        const botonContinuar = document.getElementById('boton-continuar');
        const elementoEstrellasModal = document.getElementById('estrellas-modal');
        const elementoPuntosGanados = document.getElementById('puntos-ganados');
        const elementoImagenModal = document.getElementById('imagen-modal');

        // Cargar puntuaci√≥n guardada
        function cargarPuntuacion() {
            const puntuacionGuardada = localStorage.getItem('puntuacionPuzleEspacial');
            if (puntuacionGuardada) {
                datosJuego.puntuacion = parseInt(puntuacionGuardada);
                elementoPuntuacion.textContent = datosJuego.puntuacion;
            }
        }

        // Guardar puntuaci√≥n
        function guardarPuntuacion() {
            localStorage.setItem('puntuacionPuzleEspacial', datosJuego.puntuacion.toString());
        }

        // Inicializar el juego
        function iniciarJuego() {
            cargarPuntuacion();
            configurarNivel(datosJuego.nivelActual);
            crearNavesFlotantes();
        }

        // Configurar nivel
        function configurarNivel(indiceNivel) {
            datosJuego.piezasCompletadas = 0;
            const nivel = datosJuego.niveles[indiceNivel];
            
            // Actualizar UI
            elementoNivelActual.textContent = indiceNivel + 1;
            botonSiguiente.disabled = true;
            
            // Limpiar contenedores
            contenedorPiezas.innerHTML = '';
            contenedorTablero.innerHTML = '';
            
            // Crear piezas del puzle
            crearPiezasPuzle(nivel);
            
            // Crear espacios del tablero
            crearEspaciosTablero(nivel);
        }

        // Crear piezas del puzle
        function crearPiezasPuzle(nivel) {
            const anchoPieza = 100 / nivel.columnas;
            const altoPieza = 100 / nivel.filas;
            
            for (let i = 0; i < nivel.piezas; i++) {
                const pieza = document.createElement('div');
                pieza.className = 'pieza';
                pieza.draggable = true;
                pieza.dataset.indice = i;
                
                // Estilo de fondo para mostrar la parte correcta de la imagen
                pieza.style.backgroundImage = `url(${nivel.imagen})`;
                pieza.style.backgroundSize = `${nivel.columnas * 100}% ${nivel.filas * 100}%`;
                
                // Calcular posici√≥n de fondo
                const columna = i % nivel.columnas;
                const fila = Math.floor(i / nivel.columnas);
                pieza.style.backgroundPosition = `${-columna * 100}% ${-fila * 100}%`;
                
                // Eventos drag and drop
                pieza.addEventListener('dragstart', arrastrarInicio);
                
                contenedorPiezas.appendChild(pieza);
            }
        }

        // Crear espacios del tablero
        function crearEspaciosTablero(nivel) {
            // Ajustar tama√±o del tablero seg√∫n el nivel
            contenedorTablero.style.width = `${nivel.columnas * 90 + 20}px`;
            contenedorTablero.style.height = `${nivel.filas * 90 + 20}px`;
            
            // Crear matriz para guardar posiciones
            const posiciones = [];
            for (let i = 0; i < nivel.piezas; i++) {
                posiciones.push(i);
            }
            
            // Mezclar posiciones
            mezclarArray(posiciones);
            
            // Crear espacios
            for (let i = 0; i < nivel.piezas; i++) {
                const espacio = document.createElement('div');
                espacio.className = 'espacio';
                espacio.dataset.indice = posiciones[i];
                espacio.dataset.indiceOriginal = i;
                
                // Eventos drag and drop
                espacio.addEventListener('dragover', arrastrarSobre);
                espacio.addEventListener('dragenter', arrastrarEntrar);
                espacio.addEventListener('dragleave', arrastrarSalir);
                espacio.addEventListener('drop', soltar);
                
                contenedorTablero.appendChild(espacio);
            }
        }

        // Funciones para drag and drop
        function arrastrarInicio(evento) {
            evento.dataTransfer.setData('text/plain', evento.target.dataset.indice);
            setTimeout(() => {
                evento.target.style.visibility = 'hidden';
            }, 0);
        }

        function arrastrarSobre(evento) {
            evento.preventDefault();
        }

        function arrastrarEntrar(evento) {
            evento.preventDefault();
            if (!evento.target.classList.contains('lleno')) {
                evento.target.classList.add('resaltado');
            }
        }

        function arrastrarSalir(evento) {
            evento.target.classList.remove('resaltado');
        }

        function soltar(evento) {
            evento.preventDefault();
            evento.target.classList.remove('resaltado');
            
            const indicePieza = evento.dataTransfer.getData('text/plain');
            const indiceEspacio = evento.target.dataset.indice;
            const indiceOriginal = evento.target.dataset.indiceOriginal;
            
            // Verificar si la pieza es correcta
            if (indicePieza === indiceEspacio) {
                const pieza = document.querySelector(`.pieza[data-indice="${indicePieza}"]`);
                
                // Crear copia de la pieza en el espacio
                const clonPieza = pieza.cloneNode(true);
                clonPieza.style.visibility = 'visible';
                clonPieza.style.position = 'absolute';
                clonPieza.style.top = '0';
                clonPieza.style.left = '0';
                clonPieza.style.margin = '0';
                clonPieza.style.width = '100%';
                clonPieza.style.height = '100%';
                clonPieza.style.cursor = 'default';
                clonPieza.removeAttribute('draggable');
                
                // Limpiar el espacio y a√±adir la pieza
                evento.target.innerHTML = '';
                evento.target.appendChild(clonPieza);
                evento.target.classList.add('lleno');
                
                // Eliminar la pieza original
                pieza.remove();
                
                // Actualizar progreso
                datosJuego.piezasCompletadas++;
                
                // Verificar si se complet√≥ el nivel
                if (datosJuego.piezasCompletadas === datosJuego.niveles[datosJuego.nivelActual].piezas) {
                    nivelCompletado();
                }
            }
        }

        // Nivel completado
        function nivelCompletado() {
            const nivel = datosJuego.niveles[datosJuego.nivelActual];
            
            // Calcular estrellas (1-3)
            const estrellas = Math.min(3, Math.floor(Math.random() * 3) + 1);
            const textoEstrellas = '‚≠ê'.repeat(estrellas);
            
            // Calcular puntos ganados
            const puntosGanados = nivel.puntos * estrellas;
            datosJuego.puntuacion += puntosGanados;
            
            // Actualizar UI
            elementoPuntuacion.textContent = datosJuego.puntuacion;
            elementoEstrellasModal.textContent = textoEstrellas;
            elementoPuntosGanados.textContent = puntosGanados;
            elementoImagenModal.style.backgroundImage = `url(${nivel.imagen})`;
            
            // Mostrar modal
            modalCompletado.style.display = 'flex';
            
            // Habilitar siguiente nivel
            botonSiguiente.disabled = false;
            
            // Guardar puntuaci√≥n
            guardarPuntuacion();
        }

        // Funciones auxiliares
        function mezclarArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function crearNavesFlotantes() {
            // Crear naves espaciales decorativas
            for (let i = 0; i < 5; i++) {
                const nave = document.createElement('div');
                nave.className = 'nave-espacial';
                nave.style.left = `${Math.random() * 90 + 5}%`;
                nave.style.top = `${Math.random() * 90 + 5}%`;
                nave.style.transform = `scale(${Math.random() * 0.5 + 0.5})`;
                nave.style.animationDelay = `${Math.random() * 5}s`;
                document.body.appendChild(nave);
            }
        }

        // Event listeners
        botonReiniciar.addEventListener('click', () => {
            configurarNivel(datosJuego.nivelActual);
        });

        botonSiguiente.addEventListener('click', () => {
            datosJuego.nivelActual++;
            if (datosJuego.nivelActual >= datosJuego.niveles.length) {
                datosJuego.nivelActual = 0; // Volver al primer nivel
            }
            configurarNivel(datosJuego.nivelActual);
            modalCompletado.style.display = 'none';
        });

        botonCerrarModal.addEventListener('click', () => {
            modalCompletado.style.display = 'none';
        });

        botonContinuar.addEventListener('click', () => {
            modalCompletado.style.display = 'none';
        });

        // Iniciar el juego
        iniciarJuego();
    </script>
</body>
</html>
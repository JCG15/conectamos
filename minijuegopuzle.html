<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzles Espaciales</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primario: #1a1a2e;
            --color-secundario: #4cc9f0;
            --color-acento: #0b68c5;
            --color-texto: #e2e2e2;
            --color-fondo: #0a0a1a;
            --color-fondo-nave: #0f0f23;
        }
        
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-fondo-nave);
            color: var(--color-texto);
            overflow-x: hidden;
        }
        
        /* Fondo estelar animado */
        .fondo-estelar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            overflow: hidden;
        }
        
        .estrella-fondo {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: brillar 2s infinite alternate;
        }
        
        @keyframes brillar {
            0% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
            100% { opacity: 0.3; transform: scale(1); }
        }
        
        .contenedor-juego {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        .titulo-juego {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            color: var(--color-secundario);
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }
        
        .info-juego {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            font-size: 1.2rem;
            background-color: rgba(26, 26, 46, 0.7);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(11, 104, 197, 0.2);
        }
        
        .contenedor-puzle {
            display: flex;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(26, 26, 46, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(11, 104, 197, 0.3);
            border: 1px solid var(--color-secundario);
        }
        
        .piezas-puzle {
            width: 250px;
            min-height: 300px;
            padding: 15px;
            background-color: rgba(76, 201, 240, 0.1);
            border-radius: 10px;
            border: 2px dashed var(--color-secundario);
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 10px;
        }
        
        .tablero-puzle {
            width: 350px;
            min-height: 350px;
            padding: 15px;
            background-color: rgba(26, 26, 46, 0.5);
            border-radius: 10px;
            border: 2px solid var(--color-acento);
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 10px;
            position: relative;
        }
        
        .pieza {
            width: 80px;
            height: 80px;
            cursor: move;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .pieza:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--color-secundario);
        }
        
        .espacio {
            width: 80px;
            height: 80px;
            background-color: rgba(76, 201, 240, 0.2);
            border-radius: 8px;
            border: 2px dashed var(--color-secundario);
            transition: all 0.3s ease;
        }
        
        .espacio.resaltado {
            background-color: rgba(76, 201, 240, 0.4);
            border: 2px solid var(--color-secundario);
            box-shadow: 0 0 15px var(--color-secundario);
        }
        
        .espacio.lleno {
            border: none;
            background-color: transparent;
            padding: 0;
        }
        
        .controles-juego {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        
        .btn-juego {
            background: linear-gradient(135deg, var(--color-acento), var(--color-secundario));
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-juego:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.5);
        }
        
        /* Efecto de confeti */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--color-secundario);
            opacity: 0;
            z-index: 10;
            animation: confetti-fall 2s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(300px) rotate(360deg); opacity: 0; }
        }
        
        /* Modal de nivel completado */
        .modal-completado {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal-completado.mostrar {
            opacity: 1;
            pointer-events: all;
        }
        
        .contenido-modal {
            background: linear-gradient(145deg, var(--color-primario), #2a2a4a);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            border: 2px solid var(--color-secundario);
            box-shadow: 0 0 30px var(--color-acento);
            transform: scale(0.9);
            transition: transform 0.3s;
            position: relative;
        }
        
        .modal-completado.mostrar .contenido-modal {
            transform: scale(1);
        }
        
        .imagen-modal {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 10px;
            border: 2px solid var(--color-secundario);
        }
        
        .estrellas-modal {
            font-size: 2.5em;
            color: var(--color-secundario);
            margin: 15px 0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }
        
        @media (max-width: 768px) {
            .contenedor-puzle {
                flex-direction: column;
                align-items: center;
            }
            
            .piezas-puzle, .tablero-puzle {
                width: 100%;
            }
            
            .pieza, .espacio {
                width: 70px;
                height: 70px;
            }
            
            .titulo-juego {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 576px) {
            .pieza, .espacio {
                width: 60px;
                height: 60px;
            }
            
            .info-juego {
                font-size: 1rem;
            }
            
            .btn-juego {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo estelar animado -->
    <div class="fondo-estelar" id="fondoEstelar"></div>
    
    <div class="contenedor-juego">
        <h1 class="titulo-juego">🧩 Puzles Espaciales 🚀</h1>
        
        <div class="info-juego">
            <div>Nivel: <span id="nivel-actual">1</span>/5</div>
            <div>Puntos: <span id="puntos">0</span> ✨</div>
            <div>Piezas: <span id="piezas-completadas">0</span>/<span id="total-piezas">4</span></div>
        </div>
        
        <div class="contenedor-puzle">
            <div class="piezas-puzle" id="contenedor-piezas">
                <!-- Las piezas del puzle se generarán aquí -->
            </div>
            <div class="tablero-puzle" id="contenedor-tablero">
                <!-- Los espacios del puzle se generarán aquí -->
            </div>
        </div>
        
        <div class="controles-juego">
            <button class="btn-juego" id="boton-reiniciar">
                <i class="fas fa-sync-alt"></i> Reiniciar
            </button>
            <button class="btn-juego" id="boton-siguiente" disabled>
                <i class="fas fa-arrow-right"></i> Siguiente
            </button>
        </div>
    </div>
    
    <!-- Modal de nivel completado -->
    <div class="modal-completado" id="modal-completado">
        <div class="contenido-modal">
            <h2>¡Nivel Completado!</h2>
            <div class="imagen-modal" id="imagen-modal"></div>
            <div class="estrellas-modal" id="estrellas-modal">⭐⭐⭐</div>
            <p>¡Excelente trabajo, astronauta!</p>
            <p>Has ganado <span id="puntos-ganados">0</span> puntos ✨</p>
            <button class="btn-juego" id="boton-continuar">
                <i class="fas fa-arrow-right"></i> Continuar
            </button>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Datos del juego
        const datosJuego = {
            niveles: [
                {
                    imagen: './imagenes/pipo.png',
                    piezas: 4,
                    filas: 2,
                    columnas: 2,
                    puntos: 10
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2017/02/12/21/29/moon-2060347_960_720.png',
                    piezas: 6,
                    filas: 2,
                    columnas: 3,
                    puntos: 15
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2016/11/22/15/44/astronaut-1850121_960_720.png',
                    piezas: 9,
                    filas: 3,
                    columnas: 3,
                    puntos: 20
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2011/12/13/17/00/earth-11047_960_720.png',
                    piezas: 12,
                    filas: 3,
                    columnas: 4,
                    puntos: 25
                },
                {
                    imagen: 'https://cdn.pixabay.com/photo/2016/01/19/16/49/ufo-1149817_960_720.png',
                    piezas: 16,
                    filas: 4,
                    columnas: 4,
                    puntos: 30
                }
            ],
            nivelActual: 0,
            puntuacion: 0,
            piezasCompletadas: 0,
            piezaArrastrada: null
        };

        // Elementos del DOM
        const contenedorPiezas = document.getElementById('contenedor-piezas');
        const contenedorTablero = document.getElementById('contenedor-tablero');
        const elementoNivelActual = document.getElementById('nivel-actual');
        const elementoPuntuacion = document.getElementById('puntos');
        const elementoPiezasCompletadas = document.getElementById('piezas-completadas');
        const elementoTotalPiezas = document.getElementById('total-piezas');
        const botonReiniciar = document.getElementById('boton-reiniciar');
        const botonSiguiente = document.getElementById('boton-siguiente');
        const modalCompletado = document.getElementById('modal-completado');
        const botonContinuar = document.getElementById('boton-continuar');
        const elementoEstrellasModal = document.getElementById('estrellas-modal');
        const elementoPuntosGanados = document.getElementById('puntos-ganados');
        const elementoImagenModal = document.getElementById('imagen-modal');

        // Cargar puntuación guardada
        function cargarPuntuacion() {
            const puntuacionGuardada = localStorage.getItem('puntuacionPuzleEspacial');
            if (puntuacionGuardada) {
                datosJuego.puntuacion = parseInt(puntuacionGuardada);
                elementoPuntuacion.textContent = datosJuego.puntuacion;
            }
        }

        // Guardar puntuación
        function guardarPuntuacion() {
            localStorage.setItem('puntuacionPuzleEspacial', datosJuego.puntuacion.toString());
        }

        // Crear fondo estelar
        function crearFondoEstelar() {
            const fondo = document.getElementById('fondoEstelar');
            const cantidadEstrellas = 100;
            
            for (let i = 0; i < cantidadEstrellas; i++) {
                const estrella = document.createElement('div');
                estrella.className = 'estrella-fondo';
                
                // Tamaño aleatorio
                const size = Math.random() * 3 + 1;
                estrella.style.width = `${size}px`;
                estrella.style.height = `${size}px`;
                
                // Posición aleatoria
                estrella.style.left = `${Math.random() * 100}%`;
                estrella.style.top = `${Math.random() * 100}%`;
                
                // Opacidad y animación aleatoria
                estrella.style.opacity = Math.random();
                estrella.style.animationDelay = `${Math.random() * 2}s`;
                estrella.style.animationDuration = `${Math.random() * 3 + 1}s`;
                
                fondo.appendChild(estrella);
            }
        }

        // Crear efecto de confeti
        function crearConfetti(x, y) {
            for (let i = 0; i < 10; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${x + Math.random() * 20 - 10}px`;
                confetti.style.top = `${y + Math.random() * 20 - 10}px`;
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.animationDelay = `${i * 0.1}s`;
                
                document.body.appendChild(confetti);
                
                // Eliminar después de la animación
                setTimeout(() => {
                    confetti.remove();
                }, 2000);
            }
        }
        
        function getRandomColor() {
            const colors = ['#4cc9f0', '#0b68c5', '#f72585', '#7209b7', '#3a0ca3', '#4361ee'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Inicializar el juego
        function iniciarJuego() {
            cargarPuntuacion();
            crearFondoEstelar();
            configurarNivel(datosJuego.nivelActual);
        }

        // Configurar nivel
        function configurarNivel(indiceNivel) {
            datosJuego.piezasCompletadas = 0;
            const nivel = datosJuego.niveles[indiceNivel];
            
            // Actualizar UI
            elementoNivelActual.textContent = indiceNivel + 1;
            elementoTotalPiezas.textContent = nivel.piezas;
            elementoPiezasCompletadas.textContent = '0';
            botonSiguiente.disabled = true;
            
            // Limpiar contenedores
            contenedorPiezas.innerHTML = '';
            contenedorTablero.innerHTML = '';
            
            // Crear piezas del puzle
            crearPiezasPuzle(nivel);
            
            // Crear espacios del tablero
            crearEspaciosTablero(nivel);
        }

        // Crear piezas del puzle
        function crearPiezasPuzle(nivel) {
            const anchoPieza = 100 / nivel.columnas;
            const altoPieza = 100 / nivel.filas;
            
            for (let i = 0; i < nivel.piezas; i++) {
                const pieza = document.createElement('div');
                pieza.className = 'pieza';
                pieza.draggable = true;
                pieza.dataset.indice = i;
                
                // Estilo de fondo para mostrar la parte correcta de la imagen
                pieza.style.backgroundImage = `url(${nivel.imagen})`;
                pieza.style.backgroundSize = `${nivel.columnas * 100}% ${nivel.filas * 100}%`;
                
                // Calcular posición de fondo
                const columna = i % nivel.columnas;
                const fila = Math.floor(i / nivel.columnas);
                pieza.style.backgroundPosition = `${-columna * 100}% ${-fila * 100}%`;
                
                // Eventos drag and drop
                pieza.addEventListener('dragstart', arrastrarInicio);
                pieza.addEventListener('dragend', arrastrarFinal);
                
                contenedorPiezas.appendChild(pieza);
            }
        }

        // Crear espacios del tablero
        function crearEspaciosTablero(nivel) {
            // Ajustar tamaño del tablero
            contenedorTablero.style.width = `${nivel.columnas * 90 + 40}px`;
            contenedorTablero.style.height = `${nivel.filas * 90 + 40}px`;
            
            // Crear matriz para guardar posiciones
            const posiciones = [];
            for (let i = 0; i < nivel.piezas; i++) {
                posiciones.push(i);
            }
            
            // Mezclar posiciones
            mezclarArray(posiciones);
            
            // Crear espacios
            for (let i = 0; i < nivel.piezas; i++) {
                const espacio = document.createElement('div');
                espacio.className = 'espacio';
                espacio.dataset.indice = posiciones[i];
                espacio.dataset.indiceOriginal = i;
                
                // Eventos drag and drop
                espacio.addEventListener('dragover', arrastrarSobre);
                espacio.addEventListener('dragenter', arrastrarEntrar);
                espacio.addEventListener('dragleave', arrastrarSalir);
                espacio.addEventListener('drop', soltar);
                
                contenedorTablero.appendChild(espacio);
            }
        }

        // Funciones para drag and drop
        function arrastrarInicio(evento) {
            datosJuego.piezaArrastrada = evento.target;
            evento.dataTransfer.setData('text/plain', evento.target.dataset.indice);
            setTimeout(() => {
                evento.target.style.opacity = '0.4';
            }, 0);
        }
        
        function arrastrarFinal(evento) {
            evento.target.style.opacity = '1';
        }

        function arrastrarSobre(evento) {
            evento.preventDefault();
        }

        function arrastrarEntrar(evento) {
            evento.preventDefault();
            if (!evento.target.classList.contains('lleno')) {
                evento.target.classList.add('resaltado');
            }
        }

        function arrastrarSalir(evento) {
            evento.target.classList.remove('resaltado');
        }

        function soltar(evento) {
            evento.preventDefault();
            evento.target.classList.remove('resaltado');
            
            const indicePieza = evento.dataTransfer.getData('text/plain');
            const indiceEspacio = evento.target.dataset.indice;
            
            // Verificar si la pieza es correcta
            if (indicePieza === indiceEspacio) {
                const pieza = datosJuego.piezaArrastrada;
                
                // Crear copia de la pieza en el espacio
                const clonPieza = pieza.cloneNode(true);
                clonPieza.style.position = 'absolute';
                clonPieza.style.top = '0';
                clonPieza.style.left = '0';
                clonPieza.style.width = '100%';
                clonPieza.style.height = '100%';
                clonPieza.style.margin = '0';
                clonPieza.style.opacity = '1';
                clonPieza.style.cursor = 'default';
                clonPieza.removeAttribute('draggable');
                
                // Limpiar el espacio y añadir la pieza
                evento.target.innerHTML = '';
                evento.target.appendChild(clonPieza);
                evento.target.classList.add('lleno');
                
                // Eliminar la pieza original
                pieza.remove();
                
                // Crear efecto de confeti
                const rect = evento.target.getBoundingClientRect();
                crearConfetti(rect.left + rect.width/2, rect.top + rect.height/2);
                
                // Actualizar progreso
                datosJuego.piezasCompletadas++;
                elementoPiezasCompletadas.textContent = datosJuego.piezasCompletadas;
                
                // Verificar si se completó el nivel
                if (datosJuego.piezasCompletadas === datosJuego.niveles[datosJuego.nivelActual].piezas) {
                    nivelCompletado();
                }
            } else {
                // Si la pieza no es correcta, devolverla a su posición original
                datosJuego.piezaArrastrada.style.opacity = '1';
            }
        }

        // Nivel completado
        function nivelCompletado() {
            const nivel = datosJuego.niveles[datosJuego.nivelActual];
            
            // Calcular estrellas (1-3)
            const estrellas = Math.min(3, Math.floor(Math.random() * 3) + 1);
            const textoEstrellas = '⭐'.repeat(estrellas);
            
            // Calcular puntos ganados
            const puntosGanados = nivel.puntos * estrellas;
            datosJuego.puntuacion += puntosGanados;
            
            // Actualizar UI
            elementoPuntuacion.textContent = datosJuego.puntuacion;
            elementoEstrellasModal.textContent = textoEstrellas;
            elementoPuntosGanados.textContent = puntosGanados;
            elementoImagenModal.style.backgroundImage = `url(${nivel.imagen})`;
            
            // Mostrar modal
            modalCompletado.classList.add('mostrar');
            
            // Habilitar siguiente nivel
            botonSiguiente.disabled = false;
            
            // Guardar puntuación
            guardarPuntuacion();
        }

        // Funciones auxiliares
        function mezclarArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Event listeners
        botonReiniciar.addEventListener('click', () => {
            configurarNivel(datosJuego.nivelActual);
        });

        botonSiguiente.addEventListener('click', () => {
            modalCompletado.classList.remove('mostrar');
            datosJuego.nivelActual++;
            if (datosJuego.nivelActual >= datosJuego.niveles.length) {
                datosJuego.nivelActual = 0; // Volver al primer nivel
            }
            configurarNivel(datosJuego.nivelActual);
        });

        botonContinuar.addEventListener('click', () => {
            modalCompletado.classList.remove('mostrar');
            datosJuego.nivelActual++;
            if (datosJuego.nivelActual >= datosJuego.niveles.length) {
                datosJuego.nivelActual = 0; // Volver al primer nivel
            }
            configurarNivel(datosJuego.nivelActual);
        });

        // Iniciar el juego al cargar
        document.addEventListener('DOMContentLoaded', iniciarJuego);
    </script>
</body>
</html>
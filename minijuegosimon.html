<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Conectamos - Simón Dice</title>
    <!-- Bootstrap CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome para iconos -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="icon" type="image/png" href="./imagenes/cabezapipo.png" />
    <style>
      :root {
        --color-primario: #1a1a2e;
        --color-secundario: #4cc9f0;
        --color-acento: #0b68c5;
        --color-texto: #e2e2e2;
        --color-fondo-nave: #0a0a1a;
        --color-rojo: #ff3e3e;
        --color-verde: #4caf50;
        --color-amarillo: #ffeb3b;
        --color-azul: #2196f3;
      }

      body,
      html {
        height: 100%;
        margin: 0;
        overflow: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .contenedor-juego {
        position: relative;
        height: 100vh;
        width: 100%;
        overflow: hidden;
        background: var(--color-fondo-nave);
        background-image: radial-gradient(
            circle at 20% 30%,
            rgba(76, 201, 240, 0.1) 0%,
            transparent 20%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(247, 37, 133, 0.1) 0%,
            transparent 20%
          );
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .fondo-juego {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
        opacity: 0.6;
      }

      .titulo-juego {
        color: var(--color-texto);
        font-size: 3rem;
        font-weight: 700;
        text-shadow: 0 0 15px var(--color-secundario);
        z-index: 3;
        letter-spacing: 3px;
        margin-bottom: 30px;
        text-align: center;
      }

      .panel-juego {
        background-color: rgba(26, 26, 46, 0.8);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 0 30px rgba(11, 104, 197, 0.5);
        border: 2px solid var(--color-secundario);
        z-index: 4;
        width: 90%;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .tablero-simon {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 15px;
        width: 100%;
        max-width: 300px;
        margin: 20px auto;
      }

      .boton-simon {
        aspect-ratio: 1/1;
        border-radius: 20px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .boton-simon::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        transition: opacity 0.2s;
      }

      .boton-simon.activo::after {
        opacity: 1;
      }

      .boton-simon:disabled {
        cursor: not-allowed;
        opacity: 0.7;
      }

      #simon-rojo {
        background-color: var(--color-rojo);
      }

      #simon-verde {
        background-color: var(--color-verde);
      }

      #simon-amarillo {
        background-color: var(--color-amarillo);
      }

      #simon-azul {
        background-color: var(--color-azul);
      }

      .info-juego {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-bottom: 20px;
        color: var(--color-texto);
        font-size: 1.2rem;
      }

      .controles-juego {
        display: flex;
        align-items: center;
        width: 100%;
        margin-top: 20px;
      }

      .btn-juego {
        background-color: var(--color-acento);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        margin: 10px;
        width: 100%;
        max-width: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-juego:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(11, 104, 197, 0.5);
      }

      .btn-juego i {
        margin-right: 10px;
      }

      .nivel-indicador {
        width: 100%;
        height: 10px;
        background-color: rgba(76, 201, 240, 0.2);
        border-radius: 5px;
        margin-top: 15px;
        overflow: hidden;
      }

      .nivel-progreso {
        height: 100%;
        background-color: var(--color-secundario);
        width: 0%;
        transition: width 0.5s;
      }

      .mensaje-juego {
        color: var(--color-texto);
        font-size: 1.3rem;
        margin: 15px 0;
        text-align: center;
        min-height: 40px;
        font-weight: 600;
      }

      /* Efectos de estrellas */
      .estrella {
        position: absolute;
        background-color: white;
        border-radius: 50%;
        z-index: 0;
        animation: brillar 2s infinite alternate;
      }

      @keyframes brillar {
        from {
          opacity: 0.3;
        }
        to {
          opacity: 1;
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .titulo-juego {
          font-size: 2.2rem;
          margin-bottom: 20px;
        }

        .panel-juego {
          padding: 20px;
        }

        .info-juego {
          font-size: 1rem;
        }

        .mensaje-juego {
          font-size: 1.1rem;
        }
      }

      @media (max-width: 576px) {
        .titulo-juego {
          font-size: 1.8rem;
        }

        .tablero-simon {
          max-width: 250px;
          grid-gap: 10px;
        }

        .btn-juego {
          padding: 10px 20px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="contenedor-juego">
      <h1 class="titulo-juego">Memoria Espacial</h1>

      <div class="panel-juego">
        <div class="info-juego">
          <div>Nivel: <span id="nivel">1</span></div>
          <div>Puntos: <span id="puntos">0</span></div>
          <div>Récord: <span id="record">0</span></div>
        </div>

        <div class="mensaje-juego" id="mensaje">
          Presiona Iniciar para jugar
        </div>

        <div class="tablero-simon">
          <button class="boton-simon" id="simon-rojo"></button>
          <button class="boton-simon" id="simon-verde"></button>
          <button class="boton-simon" id="simon-amarillo"></button>
          <button class="boton-simon" id="simon-azul"></button>
        </div>

        <div class="nivel-indicador">
          <div class="nivel-progreso" id="nivel-progreso"></div>
        </div>

        <div class="controles-juego">
          <button class="btn-juego" id="btn-iniciar">
            <i class="fas fa-play"></i> Iniciar
          </button>
          <button class="btn-juego" id="btn-volver">
            <i class="fas fa-arrow-left"></i> Volver
          </button>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script>
      // Variables del juego
      let secuencia = [];
      let nivelActual = 1;
      let puntos = 0;
      let record = localStorage.getItem("simonRecord") || 0;
      let jugadorActual = localStorage.getItem("nombre") || "";
      let jugando = false;
      let indiceSecuencia = 0;
      let esperandoInput = false;

      // Elementos del DOM
      const botonesSimon = document.querySelectorAll(".boton-simon");
      const btnIniciar = document.getElementById("btn-iniciar");
      const btnVolver = document.getElementById("btn-volver");
      const nivelDisplay = document.getElementById("nivel");
      const puntosDisplay = document.getElementById("puntos");
      const recordDisplay = document.getElementById("record");
      const mensajeDisplay = document.getElementById("mensaje");
      const nivelProgreso = document.getElementById("nivel-progreso");

      // Sonidos
      const sonidos = {
        rojo: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-09a.mp3"
        ),
        verde: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-09a.mp3"
        ),
        amarillo: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-09a.mp3"
        ),
        azul: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-09a.mp3"
        ),
        error: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-10.mp3"
        ),
        exito: new Audio(
          "https://www.soundjay.com/buttons/sounds/button-21.mp3"
        ),
      };



      // Inicializar el juego
      function init() {
        // Configurar record
        recordDisplay.textContent = record;

        // Event listeners
        btnIniciar.addEventListener("click", iniciarJuego);
        btnVolver.addEventListener("click", volverAlMenu);

        botonesSimon.forEach((boton) => {
          boton.addEventListener("click", manejarClick);
        });

        // Crear efecto de estrellas
        crearEstrellas();
      }



      // Función para iniciar el juego
      function iniciarJuego() {
        if (jugando) return;

        jugando = true;
        secuencia = [];
        nivelActual = 1;
        puntos = 0;
        indiceSecuencia = 0;

        nivelDisplay.textContent = nivelActual;
        puntosDisplay.textContent = puntos;
        mensajeDisplay.textContent = "Observa la secuencia...";

        btnIniciar.disabled = true;
        btnIniciar.innerHTML = '<i class="fas fa-sync-alt"></i> Reiniciar';

        // Generar primera secuencia
        agregarColorASecuencia();
        reproducirSecuencia();
      }

      // Agregar un nuevo color a la secuencia
      function agregarColorASecuencia() {
        const colores = ["rojo", "verde", "amarillo", "azul"];
        const colorAleatorio = colores[Math.floor(Math.random() * colores.length)];
        secuencia.push(colorAleatorio);
      }

      // Reproducir la secuencia actual
      function reproducirSecuencia() {
        esperandoInput = false;
        let i = 0;

        const intervalo = setInterval(() => {
          if (i >= secuencia.length) {
            clearInterval(intervalo);
            esperandoInput = true;
            mensajeDisplay.textContent = "¡Tu turno! Repite la secuencia";
            return;
          }

          const color = secuencia[i];
          resaltarBoton(color);
          i++;
        }, 800);
      }

      // Resaltar un botón (con sonido)
      function resaltarBoton(color) {
        const boton = document.getElementById(`simon-${color}`);
        boton.classList.add("activo");
        sonidos[color].currentTime = 0;
        sonidos[color].play();

        setTimeout(() => {
          boton.classList.remove("activo");
        }, 500);
      }

      // Manejar clic en los botones
      function manejarClick(e) {
        if (!jugando || !esperandoInput) return;

        const color = e.target.id.split("-")[1];
        resaltarBoton(color);

        // Verificar si es el color correcto
        if (color === secuencia[indiceSecuencia]) {
          indiceSecuencia++;

          // Secuencia completada correctamente
          if (indiceSecuencia === secuencia.length) {
            puntos += nivelActual * 10;
            puntosDisplay.textContent = puntos;

            // Actualizar progreso de nivel
            const progreso = (indiceSecuencia / (nivelActual + 3)) * 100;
            nivelProgreso.style.width = `${progreso}%`;

            // Subir de nivel cada 3 secuencias correctas
            if (secuencia.length % 3 === 0) {
              nivelActual++;
              nivelDisplay.textContent = nivelActual;
              nivelProgreso.style.width = "0%";
              sonidos.exito.play();
              mensajeDisplay.textContent = `¡Nivel ${nivelActual}! Observa la nueva secuencia...`;
            } else {
              mensajeDisplay.textContent = "¡Correcto! Siguiente secuencia...";
            }

            setTimeout(() => {
              indiceSecuencia = 0;
              agregarColorASecuencia();
              reproducirSecuencia();
            }, 1500);
          }
        } else {
          // Error - fin del juego
          sonidos.error.play();
          mensajeDisplay.textContent = "¡Oh no! Secuencia incorrecta";
          terminarJuego();
        }
      }

      // Terminar el juego
      function terminarJuego() {
        jugando = false;
        esperandoInput = false;

        if (puntos > record) {
          record = puntos;
          localStorage.setItem("simonRecord", record);
          recordDisplay.textContent = record;
        }

        // Guardar puntos temporalmente para el menú principal
        localStorage.setItem("puntosTemporales", puntos);
        localStorage.setItem("juegoOrigen", "simon");

        btnIniciar.disabled = false;
        nivelProgreso.style.width = "0%";

        // Mostrar mensaje de felicitación
            const mensaje = `¡Felicidades ${jugadorActual}!\n\nGanaste ${puntos} puntos.`;
            
            // Crear modal de felicitación dinámico
            const modalHTML = `
                <div class="modal fade" id="modalFelicitacion" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="background-color: var(--color-primario); color: white; border: 2px solid var(--color-secundario);">
                            <div class="modal-header" style="border-bottom: 1px solid var(--color-secundario);">
                                <h5 class="modal-title" style="color: var(--color-secundario);">¡Juego completado!</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <i class="fas fa-trophy fa-4x mb-3" style="color: var(--color-secundario);"></i>
                                <p>${mensaje}</p>
                            </div>
                            <div class="modal-footer" style="border-top: 1px solid var(--color-secundario);">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById('modalFelicitacion'));
            modal.show();
            
            // Eliminar el modal cuando se cierre
            document.getElementById('modalFelicitacion').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
      }

      // Guardar puntuación en el sistema principal
      function guardarPuntuacion() {
        const puntosGanados = parseInt(localStorage.getItem("puntosTemporales")) || puntos;
        let jugadores = JSON.parse(localStorage.getItem("jugadores")) || [];
        const jugadorIndex = jugadores.findIndex(
          (j) => j.nombre === jugadorActual
        );

        if (jugadorIndex !== -1) {
          jugadores[jugadorIndex].puntos += puntosGanados;
        } else {
          jugadores.push({
            nombre: jugadorActual,
            puntos: puntosGanados,
            nivel: 1,
          });
        }

        localStorage.setItem("jugadores", JSON.stringify(jugadores));
        localStorage.removeItem("puntosTemporales"); // Limpiar después de usar
        localStorage.removeItem("juegoOrigen");
      }



      // Volver al menú principal
      function volverAlMenu() {
        if (jugando) {
          if (
            !confirm(
              "¿Estás seguro de que quieres salir? Perderás tu progreso."
            )
          ) {
            // Guardar puntuación antes de salir
        if (puntos > 0) {
          guardarPuntuacion();
        }
            return;
          }
        }

        

        window.location.href = "eleccionminijuego.html";
      }




      // Crear efecto de estrellas
      function crearEstrellas() {
        const contenedor = document.querySelector(".contenedor-juego");
        const cantidad = 50;

        for (let i = 0; i < cantidad; i++) {
          const estrella = document.createElement("div");
          estrella.classList.add("estrella");

          // Tamaño aleatorio
          const size = Math.random() * 3 + 1;
          estrella.style.width = `${size}px`;
          estrella.style.height = `${size}px`;

          // Posición aleatoria
          estrella.style.left = `${Math.random() * 100}%`;
          estrella.style.top = `${Math.random() * 100}%`;

          // Opacidad y animación aleatoria
          estrella.style.opacity = Math.random();
          estrella.style.animationDelay = `${Math.random() * 2}s`;
          estrella.style.animationDuration = `${Math.random() * 3 + 1}s`;

          contenedor.appendChild(estrella);
        }
      }

      // Iniciar el juego al cargar
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>

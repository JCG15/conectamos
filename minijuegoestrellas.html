<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria de Estrellas</title>
    <!-- Bootstrap CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="./imagenes/cabezapipo.png" />
    <style>
        :root {
            --color-primario: #1a1a2e;
            --color-secundario: #4cc9f0;
            --color-acento: #0b68c5;
            --color-texto: #e2e2e2;
            --color-fondo: #0a0a1a;
        }
        
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-fondo-nave);
            color: var(--color-texto);
            overflow-x: hidden;
        }
        
        body::-webkit-scrollbar {
        width: 12px;               /* width of the entire scrollbar */
        }

        body::-webkit-scrollbar-track {
        background:  --color-primario;        /* color of the tracking area */
        }

        body::-webkit-scrollbar-thumb {
        background-color:  --color-primario;    /* color of the scroll thumb */
        border-radius: 20px;       /* roundness of the scroll thumb */
        border: 3px solid  #4cc9f0;  /* creates padding around scroll thumb */
        }


        /* Fondo estelar animado */
        .fondo-estelar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            overflow: hidden;
        }
        
        .estrella-fondo {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: brillar 2s infinite alternate;
        }
        
          @keyframes brillar {
            0% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
            100% { opacity: 0.3; transform: scale(1); }
        }
        
        .contenedor-juego {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        .titulo-juego {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            color: var(--color-secundario);
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }
        
        .tablero-memoria {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
            background-color: rgba(26, 26, 46, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(11, 104, 197, 0.3);
            border: 1px solid var(--color-secundario);
        }
        
        .carta {
            aspect-ratio: 1/1;
            background-color: linear-gradient(145deg, #2a2a4a, #1a1a2e);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            transform-style: preserve-3d;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .carta .cara {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .carta .trasera {
            background: linear-gradient(135deg, var(--color-acento), var(--color-secundario));
            transform: rotateY(0deg);
        }
        
        .carta .frente {
            background-color: var(--color-primario);
            transform: rotateY(180deg);
            font-size: 2.2rem;
        }
        
        .carta.volteada .trasera {
            transform: rotateY(180deg);
        }
        
        .carta.volteada .frente {
            transform: rotateY(0deg);
        }
        
        .carta.encontrada {
            cursor: default;
            transform: scale(0.95);
            box-shadow: 0 0 20px var(--color-secundario);
            filter: brightness(1.1);
        }
        
        .info-juego {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            font-size: 1.2rem;
            background-color: rgba(26, 26, 46, 0.7);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(11, 104, 197, 0.2);
        }
        
        .controles-juego {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        
        .btn-juego {
             background: linear-gradient(135deg, var(--color-acento), var(--color-secundario));
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-juego:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.5);
        }
        
        /* Colores para las estrellas */
        .estrella-roja { color: #ff3e3e; text-shadow: 0 0 10px #ff3e3e; }
        .estrella-azul { color: #2196f3; text-shadow: 0 0 10px #2196f3; }
        .estrella-verde { color: #4caf50; text-shadow: 0 0 10px #4caf50; }
        .estrella-amarilla { color: #ffeb3b; text-shadow: 0 0 10px #ffeb3b; }
        .estrella-purpura { color: #9c27b0; text-shadow: 0 0 10px #9c27b0; }
        .estrella-naranja { color: #ff9800; text-shadow: 0 0 10px #ff9800; }
        .estrella-rosa { color: #e91e63; text-shadow: 0 0 10px #e91e63; }
        .estrella-turquesa { color: #00bcd4; text-shadow: 0 0 10px #00bcd4; }
        

        /* Efecto de partículas al encontrar pareja */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--color-secundario);
            opacity: 0;
            z-index: 10;
            animation: confetti-fall 2s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-300px) rotate(360deg); opacity: 0; }
        }


        @media (max-width: 576px) {
            .tablero-memoria {
                gap: 10px;
                padding: 15px;
            }
            
            .carta .frente {
                font-size: 1.5rem;
            }
            
            .titulo-juego {
                font-size: 2rem;
            }
            
            .info-juego {
                font-size: 1rem;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo estelar animado -->
    <div class="fondo-estelar" id="fondoEstelar"></div>
    
    <div class="contenedor-juego">
        <h1 class="titulo-juego">Estrellas perdidas</h1>
        
        <div class="info-juego">
            <div>Parejas: <span id="parejas-encontradas">0</span>/8</div>
            <div>Movimientos: <span id="movimientos">0</span></div>
        </div>
        
        <div class="tablero-memoria" id="tablero">
            <!-- Las cartas se generarán con JavaScript -->
        </div>
        
        <div class="controles-juego">
            <button class="btn-juego" id="btn-reiniciar">
                <i class="fas fa-sync-alt"></i> Reiniciar
            </button>
            <button class="btn-juego" id="btn-volver">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables del juego
        let cartasVolteadas = [];
        let parejasEncontradas = 0;
        let movimientos = 0;
        let bloqueo = false;
        let jugadorActual = localStorage.getItem("jugadorActual") || "Jugador";
        let juegoCompletado = false;
        
        // Colores disponibles para las estrellas (8 parejas)
        const coloresEstrellas = [
            'roja', 'azul', 'verde', 'amarilla',
            'purpura', 'naranja', 'rosa', 'turquesa'
        ];
        
        // Crear fondo estelar
        function crearFondoEstelar() {
            const fondo = document.getElementById('fondoEstelar');
            const cantidadEstrellas = 100;
            
            for (let i = 0; i < cantidadEstrellas; i++) {
                const estrella = document.createElement('div');
                estrella.className = 'estrella-fondo';
                
                // Tamaño aleatorio
                const size = Math.random() * 3 + 1;
                estrella.style.width = `${size}px`;
                estrella.style.height = `${size}px`;
                
                // Posición aleatoria
                estrella.style.left = `${Math.random() * 100}%`;
                estrella.style.top = `${Math.random() * 100}%`;
                
                // Opacidad y animación aleatoria
                estrella.style.opacity = Math.random();
                estrella.style.animationDelay = `${Math.random() * 2}s`;
                estrella.style.animationDuration = `${Math.random() * 3 + 1}s`;
                
                fondo.appendChild(estrella);
            }
        }

        // Crear efecto de confeti
        function crearConfetti(x, y, color) {
            for (let i = 0; i < 7; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${x}px`;
                confetti.style.top = `${y}px`;
                confetti.style.backgroundColor = color || getRandomColor();
                confetti.style.animationDelay = `${i * 0.1}s`;
                
                document.body.appendChild(confetti);
                
                // Eliminar después de la animación
                setTimeout(() => {
                    confetti.remove();
                }, 1000);
            }
        }
        
        function getRandomColor() {
            const colors = ['#ff3e3e', '#2196f3', '#4caf50', '#ffeb3b', '#9c27b0', '#ff9800'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Inicializar el juego
        function iniciarJuego() {
            const tablero = document.getElementById('tablero');
            tablero.innerHTML = '';
            
            // Crear un array con las parejas de cartas
            let cartas = [];
            coloresEstrellas.forEach(color => {
                cartas.push({ color, encontrada: false });
                cartas.push({ color, encontrada: false });
            });
            
            // Barajar las cartas
            cartas = cartas.sort(() => Math.random() - 0.5);
            
            // Crear las cartas en el tablero
            cartas.forEach((carta, index) => {
                const elementoCarta = document.createElement('div');
                elementoCarta.className = 'carta';
                elementoCarta.dataset.indice = index;
                elementoCarta.dataset.color = carta.color;
                
                elementoCarta.innerHTML = `
                    <div class="cara trasera">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="cara frente">
                        <i class="fas fa-star estrella-${carta.color}"></i>
                    </div>
                `;
                
                elementoCarta.addEventListener('click', voltearCarta);
                tablero.appendChild(elementoCarta);
            });
            
            // Reiniciar contadores
            parejasEncontradas = 0;
            movimientos = 0;
            cartasVolteadas = [];
            bloqueo = false;
            actualizarContadores();
        }
        
        // Voltear una carta
        function voltearCarta() {
            if (bloqueo || this.classList.contains('volteada') || this.classList.contains('encontrada')) {
                return;
            }
            
            // Voltear la carta
            this.classList.add('volteada');
            cartasVolteadas.push(this);
            
            // Sonido al voltear
            const sonidoVoltear = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3');
            sonidoVoltear.play();
            
            // Verificar si hay dos cartas volteadas
            if (cartasVolteadas.length === 2) {
                movimientos++;
                actualizarContadores();
                verificarPareja();
            }
        }
        
        // Verificar si las cartas volteadas son pareja
        function verificarPareja() {
            bloqueo = true;
            
            const [carta1, carta2] = cartasVolteadas;
            const esPareja = carta1.dataset.color === carta2.dataset.color;
            
            if (esPareja) {
                // Sonido de acierto
                const sonidoAcierto = new Audio('https://www.soundjay.com/buttons/sounds/button-21.mp3');
                sonidoAcierto.play();
                
                // Pareja encontrada
                carta1.classList.add('encontrada');
                carta2.classList.add('encontrada');
                parejasEncontradas++;

                // Confetti
                const rect1 = carta1.getBoundingClientRect();
                const rect2 = carta2.getBoundingClientRect();
                crearConfetti(rect1.left + rect1.width/2.3, rect1.top + rect1.height/1.8, getComputedStyle(carta1.querySelector('.frente i')).color);
                crearConfetti(rect2.left + rect2.width/2.3, rect2.top + rect2.height/1.8, getComputedStyle(carta2.querySelector('.frente i')).color);
                
                // Verificar si el juego ha terminado
                if (parejasEncontradas === coloresEstrellas.length) {
                    setTimeout(finalizarJuego, 500);
                }
                
                cartasVolteadas = [];
                bloqueo = false;
            } else {
                // Sonido de error
                const sonidoError = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');
                sonidoError.play();
                
                // No es pareja, voltear de nuevo después de un tiempo
                setTimeout(() => {
                    carta1.classList.remove('volteada');
                    carta2.classList.remove('volteada');
                    cartasVolteadas = [];
                    bloqueo = false;
                }, 1000);
            }
        }
        
        // Actualizar los contadores de juego
        function actualizarContadores() {
            document.getElementById('parejas-encontradas').textContent = parejasEncontradas;
            document.getElementById('movimientos').textContent = movimientos;
        }
        
        
        // Finalizar el juego
        function finalizarJuego() {
            // Calcular puntos (menos movimientos = más puntos)
            const puntos = Math.max(150 - movimientos * 3, 10);
            
            // Guardar puntos para mostrar en el menú principal
            if (puntos > 0) {
                const puntosGanados = parseInt(localStorage.getItem("puntosTemporales")) || puntos;
                let jugadores = JSON.parse(localStorage.getItem("jugadores")) || [];
                const jugadorIndex = jugadores.findIndex(
                (j) => j.nombre === jugadorActual
                );

                if (jugadorIndex !== -1) {
                jugadores[jugadorIndex].puntos += puntosGanados;
                } else {
                jugadores.push({
                    nombre: jugadorActual,
                    puntos: puntosGanados,
                    nivel: 1,
                });
                }

                localStorage.setItem("jugadores", JSON.stringify(jugadores));
                localStorage.removeItem("puntosTemporales"); // Limpiar después de usar
                localStorage.removeItem("juegoOrigen");
            }
            
            // Mostrar mensaje de felicitación
            const mensaje = `¡Felicidades ${jugadorActual}!\n\nEncontraste todas las parejas en ${movimientos} movimientos.\n\nGanaste ${puntos} puntos.`;
            
            // Crear modal de felicitación dinámico
            const modalHTML = `
                <div class="modal fade" id="modalFelicitacion" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="background-color: var(--color-primario); color: white; border: 2px solid var(--color-secundario);">
                            <div class="modal-header" style="border-bottom: 1px solid var(--color-secundario);">
                                <h5 class="modal-title" style="color: var(--color-secundario);">¡Juego completado!</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <i class="fas fa-trophy fa-4x mb-3" style="color: var(--color-secundario);"></i>
                                <p>${mensaje}</p>
                            </div>
                            <div class="modal-footer" style="border-top: 1px solid var(--color-secundario);">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById('modalFelicitacion'));
            modal.show();
            
            // Eliminar el modal cuando se cierre
            document.getElementById('modalFelicitacion').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
        


        // Volver al menú principal
        function volverAlMenu() {
            if (parejasEncontradas > 0 || movimientos > 0) {
                if (!confirm('¿Estás seguro de que quieres salir? Perderás tu progreso.')) {
                     // Guardar puntuación antes de salir
                    return;
                }
            }

            window.location.href = 'eleccionminijuego.html';
        }
        
        // Event listeners
        document.getElementById('btn-reiniciar').addEventListener('click', iniciarJuego);
        document.getElementById('btn-volver').addEventListener('click', volverAlMenu);
        
        // Iniciar el juego al cargar
        document.addEventListener('DOMContentLoaded', function() {
            crearFondoEstelar();
            iniciarJuego();
        });
    </script>
</body>
</html>